{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/main.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","window","onerror","text","html","replace","text2html","loading","document","getElementById","innerHTML","style","zIndex","water","cubemap","renderer","center","oldCenter","velocity","gravity","radius","gl","GL","angleX","angleY","useSpherePhysics","paused","onload","ratio","devicePixelRatio","help","onresize","width","innerWidth","clientWidth","height","innerHeight","canvas","viewport","matrixMode","PROJECTION","loadIdentity","perspective","MODELVIEW","draw","body","appendChild","clearColor","Water","Renderer","Cubemap","xneg","xpos","yneg","ypos","zneg","zpos","textureA","canDrawTo","textureB","Error","Vector","addDrop","Math","random","prevHit","planeNormal","requestAnimationFrame","webkitRequestAnimationFrame","callback","setTimeout","prevTime","Date","getTime","animate","nextTime","seconds","MODE_MOVE_SPHERE","percentUnderWater","max","min","y","add","multiply","subtract","unit","dot","abs","moveSphere","stepSimulation","updateNormals","updateCaustics","update","oldX","oldY","MODE_ADD_DROPS","MODE_ORBIT_CAMERA","startDrag","x","tracer","Raytracer","ray","getRayForPixel","pointOnPlane","eye","sphereHitTest","hitTestSphere","hit","negative","z","duringDrag","nextHit","stopDrag","isHelpElement","element","parentNode","onmousedown","e","target","preventDefault","pageX","pageY","onmousemove","onmouseup","ontouchstart","touches","length","ontouchmove","ontouchend","onkeydown","which","charCodeAt","keys","L","lightDir","fromAngles","PI","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","translate","rotate","enable","DEPTH_TEST","sphereCenter","sphereRadius","renderCube","renderWater","renderSphere","disable"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*\n * WebGL Water\n * http://madebyevan.com/webgl-water/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\nfunction text2html(text) {\n  return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n/g, '<br>');\n}\n\nfunction handleError(text) {\n  var html = text2html(text);\n  if (html == 'WebGL not supported') {\n    html = 'Your browser does not support WebGL.<br>Please see\\\n    <a href=\"http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">\\\n    Getting a WebGL Implementation</a>.';\n  }\n  var loading = document.getElementById('loading');\n  loading.innerHTML = html;\n  loading.style.zIndex = 1;\n}\n\nwindow.onerror = handleError;\n\nvar gl = GL.create();\nvar water;\nvar cubemap;\nvar renderer;\nvar angleX = -25;\nvar angleY = -200.5;\n\n// Sphere physics info\nvar useSpherePhysics = false;\nvar center;\nvar oldCenter;\nvar velocity;\nvar gravity;\nvar radius;\nvar paused = false;\n\nwindow.onload = function() {\n  var ratio = window.devicePixelRatio || 1;\n  var help = document.getElementById('help');\n\n  function onresize() {\n    var width = innerWidth - help.clientWidth - 20;\n    var height = innerHeight;\n    gl.canvas.width = width * ratio;\n    gl.canvas.height = height * ratio;\n    gl.canvas.style.width = width + 'px';\n    gl.canvas.style.height = height + 'px';\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n    gl.matrixMode(gl.PROJECTION);\n    gl.loadIdentity();\n    gl.perspective(45, gl.canvas.width / gl.canvas.height, 0.01, 100);\n    gl.matrixMode(gl.MODELVIEW);\n    draw();\n  }\n\n  document.body.appendChild(gl.canvas);\n  gl.clearColor(0, 0, 0, 1);\n\n  water = new Water();\n  renderer = new Renderer();\n  cubemap = new Cubemap({\n    xneg: document.getElementById('xneg'),\n    xpos: document.getElementById('xpos'),\n    yneg: document.getElementById('ypos'),\n    ypos: document.getElementById('ypos'),\n    zneg: document.getElementById('zneg'),\n    zpos: document.getElementById('zpos')\n  });\n\n  if (!water.textureA.canDrawTo() || !water.textureB.canDrawTo()) {\n    throw new Error('Rendering to floating-point textures is required but not supported');\n  }\n\n  center = oldCenter = new GL.Vector(-0.4, -0.75, 0.2);\n  velocity = new GL.Vector();\n  gravity = new GL.Vector(0, -4, 0);\n  radius = 0.25;\n\n  for (var i = 0; i < 20; i++) {\n    water.addDrop(Math.random() * 2 - 1, Math.random() * 2 - 1, 0.03, (i & 1) ? 0.01 : -0.01);\n  }\n\n  document.getElementById('loading').innerHTML = '';\n  onresize();\n\n  var requestAnimationFrame =\n    window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    function(callback) { setTimeout(callback, 0); };\n\n  var prevTime = new Date().getTime();\n  function animate() {\n    var nextTime = new Date().getTime();\n    if (!paused) {\n      update((nextTime - prevTime) / 1000);\n      draw();\n    }\n    prevTime = nextTime;\n    requestAnimationFrame(animate);\n  }\n  requestAnimationFrame(animate);\n\n  window.onresize = onresize;\n\n  var prevHit;\n  var planeNormal;\n  var mode = -1;\n  var MODE_ADD_DROPS = 0;\n  var MODE_MOVE_SPHERE = 1;\n  var MODE_ORBIT_CAMERA = 2;\n\n  var oldX, oldY;\n\n  function startDrag(x, y) {\n    oldX = x;\n    oldY = y;\n    var tracer = new GL.Raytracer();\n    var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n    var pointOnPlane = tracer.eye.add(ray.multiply(-tracer.eye.y / ray.y));\n    var sphereHitTest = GL.Raytracer.hitTestSphere(tracer.eye, ray, center, radius);\n    if (sphereHitTest) {\n      mode = MODE_MOVE_SPHERE;\n      prevHit = sphereHitTest.hit;\n      planeNormal = tracer.getRayForPixel(gl.canvas.width / 2, gl.canvas.height / 2).negative();\n    } else if (Math.abs(pointOnPlane.x) < 1 && Math.abs(pointOnPlane.z) < 1) {\n      mode = MODE_ADD_DROPS;\n      duringDrag(x, y);\n    } else {\n      mode = MODE_ORBIT_CAMERA;\n    }\n  }\n\n  function duringDrag(x, y) {\n    switch (mode) {\n      case MODE_ADD_DROPS: {\n        var tracer = new GL.Raytracer();\n        var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n        var pointOnPlane = tracer.eye.add(ray.multiply(-tracer.eye.y / ray.y));\n        water.addDrop(pointOnPlane.x, pointOnPlane.z, 0.03, 0.01);\n        if (paused) {\n          water.updateNormals();\n          renderer.updateCaustics(water);\n        }\n        break;\n      }\n      case MODE_MOVE_SPHERE: {\n        var tracer = new GL.Raytracer();\n        var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n        var t = -planeNormal.dot(tracer.eye.subtract(prevHit)) / planeNormal.dot(ray);\n        var nextHit = tracer.eye.add(ray.multiply(t));\n        center = center.add(nextHit.subtract(prevHit));\n        center.x = Math.max(radius - 1, Math.min(1 - radius, center.x));\n        center.y = Math.max(radius - 1, Math.min(10, center.y));\n        center.z = Math.max(radius - 1, Math.min(1 - radius, center.z));\n        prevHit = nextHit;\n        if (paused) renderer.updateCaustics(water);\n        break;\n      }\n      case MODE_ORBIT_CAMERA: {\n        angleY -= x - oldX;\n        angleX -= y - oldY;\n        angleX = Math.max(-89.999, Math.min(89.999, angleX));\n        break;\n      }\n    }\n    oldX = x;\n    oldY = y;\n    if (paused) draw();\n  }\n\n  function stopDrag() {\n    mode = -1;\n  }\n\n  function isHelpElement(element) {\n    return element === help || element.parentNode && isHelpElement(element.parentNode);\n  }\n\n  document.onmousedown = function(e) {\n    if (!isHelpElement(e.target)) {\n      e.preventDefault();\n      startDrag(e.pageX, e.pageY);\n    }\n  };\n\n  document.onmousemove = function(e) {\n    duringDrag(e.pageX, e.pageY);\n  };\n\n  document.onmouseup = function() {\n    stopDrag();\n  };\n\n  document.ontouchstart = function(e) {\n    if (e.touches.length === 1 && !isHelpElement(e.target)) {\n      e.preventDefault();\n      startDrag(e.touches[0].pageX, e.touches[0].pageY);\n    }\n  };\n\n  document.ontouchmove = function(e) {\n    if (e.touches.length === 1) {\n      duringDrag(e.touches[0].pageX, e.touches[0].pageY);\n    }\n  };\n\n  document.ontouchend = function(e) {\n    if (e.touches.length == 0) {\n      stopDrag();\n    }\n  };\n\n  document.onkeydown = function(e) {\n    if (e.which == ' '.charCodeAt(0)) paused = !paused;\n    else if (e.which == 'G'.charCodeAt(0)) useSpherePhysics = !useSpherePhysics;\n    else if (e.which == 'L'.charCodeAt(0) && paused) draw();\n  };\n\n  var frame = 0;\n\n  function update(seconds) {\n    if (seconds > 1) return;\n    frame += seconds * 2;\n\n    if (mode == MODE_MOVE_SPHERE) {\n      // Start from rest when the player releases the mouse after moving the sphere\n      velocity = new GL.Vector();\n    } else if (useSpherePhysics) {\n      // Fall down with viscosity under water\n      var percentUnderWater = Math.max(0, Math.min(1, (radius - center.y) / (2 * radius)));\n      velocity = velocity.add(gravity.multiply(seconds - 1.1 * seconds * percentUnderWater));\n      velocity = velocity.subtract(velocity.unit().multiply(percentUnderWater * seconds * velocity.dot(velocity)));\n      center = center.add(velocity.multiply(seconds));\n\n      // Bounce off the bottom\n      if (center.y < radius - 1) {\n        center.y = radius - 1;\n        velocity.y = Math.abs(velocity.y) * 0.7;\n      }\n    }\n\n    // Displace water around the sphere\n    water.moveSphere(oldCenter, center, radius);\n    oldCenter = center;\n\n    // Update the water simulation and graphics\n    water.stepSimulation();\n    water.stepSimulation();\n    water.updateNormals();\n    renderer.updateCaustics(water);\n  }\n\n  function draw() {\n    // Change the light direction to the camera look vector when the L key is pressed\n    if (GL.keys.L) {\n      renderer.lightDir = GL.Vector.fromAngles((90 - angleY) * Math.PI / 180, -angleX * Math.PI / 180);\n      if (paused) renderer.updateCaustics(water);\n    }\n\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.loadIdentity();\n    gl.translate(0, 0, -4);\n    gl.rotate(-angleX, 1, 0, 0);\n    gl.rotate(-angleY, 0, 1, 0);\n    gl.translate(0, 0.5, 0);\n\n    gl.enable(gl.DEPTH_TEST);\n    renderer.sphereCenter = center;\n    renderer.sphereRadius = radius;\n    renderer.renderCube();\n    renderer.renderWater(water, cubemap);\n    renderer.renderSphere();\n    gl.disable(gl.DEPTH_TEST);\n  }\n};\n"],"sourceRoot":""}